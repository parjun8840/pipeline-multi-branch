pipeline {
    agent {label 'DONT-USE-THIS'}
    stages {
        stage('Build Main') {
            when {
                branch 'main'
            }
            steps {
                echo 'Building main'
                script{
                 def changedFiles = []
                 changedFiles = getChangedFiles()
                if(changedFiles.size>0){
                    println(changedFiles)
                 }
                 else{
                    println("No changed file.")
                 }
            }
        }
        }
        stage('Build Dev') {
            when {
                branch 'dev'
            }
            steps {
                echo 'Building dev'
            }
        }
    }
}


def getChangedFiles(){
   def changes = []
   def changeLogSets = currentBuild.changeSets
   def filePath = ""
   for (int i = 0; i < changeLogSets.size(); i++) {
      def entries = changeLogSets[i].items
      for (int j = 0; j < entries.length; j++) {
         def entry = entries[j]
         def files = new ArrayList(entry.affectedFiles)
         for (int k = 0; k < files.size(); k++) {
            def file = files[k]
            filePath += "${file.path}"
         }
      }
   }
   changes.unique();
   changes.sort();
   return changes;
}

